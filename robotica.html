<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Presença</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 800px; margin-top: 20px; }
        table { background-color: white; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center mb-4">Registro de Presença - ROBÓTICA</h2>

    <div class="mb-3">
        <label for="data_aula" class="form-label">Data da Aula</label>
        <input type="date" id="data_aula" class="form-control">
    </div>

    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Nº</th>
                <th>Nome do Aluno</th>
                <th>Presente</th>
                <th>Total Aulas</th>
                <th>Aulas Presentes</th>
                <th>%</th>
            </tr>
        </thead>
        <tbody id="lista-alunos">
            <!-- Lista de 50 alunos fictícios -->
            <script>
                const nomes = [
                    "Ana Souza","Bruno Lima","Carlos Mendes","Daniela Rocha","Eduardo Alves",
                    "Fernanda Torres","Gabriel Martins","Helena Costa","Igor Ribeiro","Joana Freitas",
                    "Kleber Santos","Larissa Gomes","Marcos Vieira","Natália Duarte","Otávio Farias",
                    "Patrícia Ramos","Quésia Monteiro","Ricardo Pires","Sabrina Lopes","Tiago Nunes",
                    "Ursula Andrade","Vinícius Matos","Wesley Barros","Xavier Silva","Yasmin Prado",
                    "Zilda Rezende","Arthur Cunha","Beatriz Correia","Caio Neves","Débora Batista",
                    "Enzo Carvalho","Flávia Cardoso","Gustavo Moreira","Heloísa Meireles","Isabela Soares",
                    "Júlio Fernandes","Kamila Brandão","Leandro Tavares","Melissa Peixoto","Nicolas Pinto",
                    "Olívia Rocha","Paulo César","Queila Fonseca","Rafael Almeida","Sara Menezes",
                    "Túlio Campos","Vera Lúcia","William Costa","Yuri Fonseca","Zuleica Campos"
                ];

                document.addEventListener("DOMContentLoaded", () => {
                    const tbody = document.getElementById("lista-alunos");
                    nomes.forEach((nome, index) => {
                        tbody.innerHTML += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${nome}</td>
                                <td><input type="checkbox" class="form-check-input presente"></td>
                                <td><input type="number" class="form-control total_aulas" value="10"></td>
                                <td><input type="number" class="form-control aulas_presentes" value="0"></td>
                                <td><input type="number" class="form-control percentual" value="0"></td>
                            </tr>
                        `;
                    });
                });
            </script>
        </tbody>
    </table>

    <button class="btn btn-success w-100" onclick="salvarDados()">Salvar Registros</button>
    <div id="mensagem" class="mt-3 text-center"></div>
</div>

<script>
    const API_TOKEN = "zaa0Pfbm4SCbaivRvMmlSEWGKdtldXNd";
    const TABLE_ID = "642370";

    async function salvarDados() {
        const dataAula = document.getElementById("data_aula").value;
        const linhas = document.querySelectorAll("#lista-alunos tr");
        let registrosSalvos = 0;

        for (let i = 0; i < linhas.length; i++) {
            const numero = i + 1;
            const nome = nomes[i];
            const presente = linhas[i].querySelector(".presente").checked;
            const totalAulas = linhas[i].querySelector(".total_aulas").value;
            const aulasPresentes = linhas[i].querySelector(".aulas_presentes").value;
            const percentual = linhas[i].querySelector(".percentual").value;

            const payload = {
                fields: {
                    "5247573": numero,
                    "5247574": nome,
                    "5247596": dataAula,
                    "5247575": presente,
                    "5247608": parseInt(totalAulas),
                    "5247609": parseInt(aulasPresentes),
                    "5247669": parseFloat(percentual)
                }
            };

            let res = await fetch(`https://api.baserow.io/api/database/rows/table/${TABLE_ID}/`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Token ${API_TOKEN}`
                },
                body: JSON.stringify(payload)
            });

            if (res.ok) {
                registrosSalvos++;
            }
        }

        document.getElementById("mensagem").innerHTML =
            `<div class="alert alert-success">✅ ${registrosSalvos} registros salvos com sucesso!</div>`;
    }
</script>

</body>
</html>
