<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Controle de Presença - Clube de Robótica</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { background-color: #f8f9fa; }
    table { background: white; }
    th, td { text-align: center; vertical-align: middle; }
</style>
</head>
<body class="container py-4">

<h2 class="mb-4 text-center">Controle Presença - Clube de Robótica</h2>

<div class="mb-3">
    <label for="data_geral" class="form-label">Data da Aula</label>
    <input type="date" id="data_geral" class="form-control" onchange="atualizarDataTodas()">
</div>

<div class="mb-3">
    <button class="btn btn-success me-2" onclick="habilitarTodos()">Habilitar Todos</button>
    <button class="btn btn-danger" onclick="desabilitarTodos()">Desabilitar Todos</button>
</div>

<table class="table table-bordered table-striped table-hover">
    <thead class="table-dark">
        <tr>
            <th>Nº</th>
            <th>Nome do Aluno</th>
            <th>Data</th>
            <th>Presente</th>
            <th>% Presença</th>
        </tr>
    </thead>
    <tbody id="tabelaAlunos">
        <!-- Alunos serão inseridos via JavaScript -->
    </tbody>
</table>

<div class="mt-3">
    <button class="btn btn-primary" onclick="salvarPresencas()">Salvar Presenças</button>
</div>

<script>
const API_TOKEN = "zaa0Pfbm4SCbaivRvMmlSEWGKdtldXNd";
const TABLE_ID = "642370";

// Lista de 50 nomes fictícios
const alunos = [
    "Ana Souza","Bruno Lima","Carlos Mendes","Daniela Rocha","Eduardo Castro",
    "Fernanda Alves","Gabriel Costa","Helena Duarte","Igor Pereira","Julia Nogueira",
    "Kleber Ramos","Larissa Cardoso","Marcos Vieira","Natália Campos","Otávio Barbosa",
    "Patrícia Melo","Quésia Andrade","Rafael Silva","Sabrina Fonseca","Tiago Moreira",
    "Ursula Martins","Vinícius Teixeira","Wellington Prado","Xavier Almeida","Yasmin Oliveira",
    "Zeca Farias","Amanda Brito","Breno Araújo","Clara Pires","Diego Lopes",
    "Elaine Moraes","Fábio Correia","Giovana Santana","Henrique Brito","Isabela Souza",
    "João Victor","Karen Barbosa","Lucas Martins","Marina Dias","Nicolas Ribeiro",
    "Olívia Torres","Paulo Henrique","Queila Batista","Rodrigo Almeida","Silvia Freitas",
    "Tatiane Rocha","Ulisses Gomes","Vera Lúcia","Willian Monteiro","Yuri Fernandes"
];

// Preenche tabela
let tabela = document.getElementById("tabelaAlunos");
alunos.forEach((nome, i) => {
    let num = i + 1;
    tabela.innerHTML += `
        <tr>
            <td id="numero_${num}">${num}</td>
            <td id="nome_${num}">${nome}</td>
            <td><input type="date" id="data_${num}" class="form-control"></td>
            <td><input type="checkbox" id="presente_${num}" onchange="calcularPercentual(${num})"></td>
            <td id="percentual_${num}">0%</td>
        </tr>
    `;
});

// Atualiza data de todos
function atualizarDataTodas() {
    const dataGeral = document.getElementById("data_geral").value;
    alunos.forEach((_, i) => {
        document.getElementById(`data_${i+1}`).value = dataGeral;
    });
}

// Habilitar todos
function habilitarTodos() {
    alunos.forEach((_, i) => {
        document.getElementById(`presente_${i+1}`).checked = true;
        calcularPercentual(i+1);
    });
}

// Desabilitar todos
function desabilitarTodos() {
    alunos.forEach((_, i) => {
        document.getElementById(`presente_${i+1}`).checked = false;
        calcularPercentual(i+1);
    });
}

// Calcula percentual
function calcularPercentual(id) {
    let totalAulas = 1;
    let aulasPresentes = document.getElementById(`presente_${id}`).checked ? 1 : 0;
    let percentual = ((aulasPresentes / totalAulas) * 100).toFixed(0) + "%";
    document.getElementById(`percentual_${id}`).innerText = percentual;
}

// Salva no Baserow
function salvarPresencas() {
    alunos.forEach((_, i) => {
        let id = i + 1;
        let numero = document.getElementById(`numero_${id}`).textContent;
        let nome = document.getElementById(`nome_${id}`).textContent;
        let dataAula = document.getElementById(`data_${id}`).value;
        let presente = document.getElementById(`presente_${id}`).checked ? "Sim" : "Não";
        let totalAulas = 1;
        let aulasPresentes = presente === "Sim" ? 1 : 0;
        let percentual = document.getElementById(`percentual_${id}`).innerText;

        if (!dataAula) return; // ignora linhas sem data

        fetch(`https://api.baserow.io/api/database/rows/table/${TABLE_ID}/`, {
            method: "POST",
            headers: {
                "Authorization": `Token ${API_TOKEN}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                5247573: numero,
                5247574: nome,
                5247596: dataAula,
                5247575: presente,
                5247608: totalAulas,
                5247609: aulasPresentes,
                5247669: percentual
            })
        })
        .then(res => res.json())
        .then(data => console.log("Salvo:", data))
        .catch(err => console.error("Erro:", err));
    });

    alert("Presenças salvas no Baserow!");
}
</script>

</body>
</html>
